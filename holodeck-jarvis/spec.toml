[package]
name = "holodeck-jarvis"
version = "1.2"
release = 1
description = "configuration for raspberry pi 'jarvis'"
requires = [
	# hologram-dummy provides holo-users-groups and holo-files.
	# See https://github.com/holocm/holo-build/issues/19
	"hologram-dummy",

	"hologram-base",
	"wpa_supplicant",
]


# user

[[user]]
name    = "laerling"
system  = false
comment = "Benjamin Ludwig"
uid     = 1001
groups  = [ "audio", "video", "wheel" ]
home    = "/home/laerling"
shell   = "/bin/bash"

[[directory]]
path = "/home/laerling"
mode = "0700"
owner = 1001
group = 1001


# networking

# WLAN
[[file]]
path = "/etc/wpa_supplicant/wpa_supplicant-wlan0.conf"
contentFrom = "wpa_supplicant-wlan0.conf"
[[symlink]]
# as created by `systemctl enable wpa_supplicant@wlan0`
path = "/etc/systemd/system/multi-user.target.wants/wpa_supplicant@wlan0.service"
target = "/usr/lib/systemd/system/wpa_supplicant@.service"

# dhcp
[[symlink]]
# as created by `systemctl enable dhcpcd`
path = "/etc/systemd/system/multi-user.target.wants/dhcpcd.service"
target = "/usr/lib/systemd/system/dhcpcd.service"

# DNS
[[symlink]]
# as created by `systemctl enable systemd-resolved`
path = "/etc/systemd/system/dbus-org.freedesktop.resolve1.service"
target = "/usr/lib/systemd/system/systemd-resolved.service"
[[symlink]]
# as created by `systemctl enable systemd-resolved`
path = "/etc/systemd/system/multi-user.target.wants/systemd-resolved.service"
target = "/usr/lib/systemd/system/systemd-resolved.service"


# workaround to keep jarvis from switching to boot screen every now and then
# see https://raspberrypi.stackexchange.com/questions/84240
[[file]]
path = "/etc/modprobe.d/nobootscreen.conf"
mode = "0444"
content = "blacklist vc4" # vc4 seems to be for hardware graphics acceleration

# keep jarvis from logging kaudit messages to the console all the time
# see https://raspberrypi.stackexchange.com/questions/351387
# and https://raspberrypi.stackexchange.com/questions/13019
# The current setting can be read from /proc/sys/kernel/printk
# Before adding printk.conf it was 7 4 1 7
[[file]]
path = "/etc/sysctl.d/printk.conf"
mode = "0444"
content = "kernel.printk = 3 4 1 3"
